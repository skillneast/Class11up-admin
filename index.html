<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All-in-One Admin Panel</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        :root { --primary-bg: #141b2d; --secondary-bg: #1f2a40; --card-bg: #293651; --button-color: #868dfb; --danger-color: #ff7e5f; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--primary-bg); color: white; font-size: 14px; }
        .container { max-width: 900px; margin: 20px auto; padding: 20px; }
        h2, h3, h4 { border-bottom: 1px solid var(--button-color); padding-bottom: 10px; margin-bottom: 20px; }
        h4 { border-bottom-style: dashed; font-size: 1em; margin-top: 20px;}
        .section { background-color: var(--secondary-bg); padding: 20px; border-radius: 12px; margin-bottom: 20px; }
        input, select, button { width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 8px; border: none; font-family: 'Poppins', sans-serif; font-size: 1em; }
        input, select { background-color: var(--card-bg); color: white; }
        button { background-color: var(--button-color); color: white; font-weight: 600; cursor: pointer; }
        button.danger { background-color: var(--danger-color); }
        .item { display: flex; justify-content: space-between; align-items: center; background-color: var(--card-bg); padding: 15px; border-radius: 8px; margin-bottom: 10px; }
        .item span { font-weight: 500; }
        .delete-btn { background: none; border: none; color: var(--danger-color); cursor: pointer; font-size: 16px; }
        .nested-section { border: 1px solid var(--card-bg); border-radius: 8px; padding: 15px; margin-top: 15px; }
    </style>
</head>
<body>
<div class="container">
    <h2><i class="fas fa-cogs"></i> Website Admin Panel</h2>

    <div class="section">
        <h3><i class="fas fa-globe"></i> General Settings</h3>
        <input type="text" id="logo-link" placeholder="Logo Link (e.g., https://yoursite.com)">
        <input type="text" id="telegram-link" placeholder="Telegram Channel Link">
        <input type="text" id="contact-link" placeholder="Contact/Support Link">
        <button id="save-settings-btn">Save Settings</button>
    </div>

    <div class="section">
        <h3><i class="fas fa-layer-group"></i> Manage Batches</h3>
        <input type="text" id="batch-title" placeholder="New Batch Title (e.g., UP Board Class 11)">
        <input type="text" id="batch-image" placeholder="New Batch Image URL">
        <button id="add-batch-btn">Add New Batch</button>
        <div id="batches-list" class="item-list"></div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
    import { getDatabase, ref, set, push, onValue, remove } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";
    const firebaseConfig = {
      apiKey: "AIzaSyC1m25mHpA59xBQmF34BfA1K_vY2pUSrLI",
      authDomain: "fahad-portfolio-81c65.firebaseapp.com",
      databaseURL: "https://fahad-portfolio-81c65-default-rtdb.firebaseio.com",
      projectId: "fahad-portfolio-81c65",
      storageBucket: "fahad-portfolio-81c65.firebasestorage.app",
      messagingSenderId: "510625882446",
      appId: "1:510625882446:web:b23f76808b3dd0e79a3e1f"
    };
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);

    // --- GENERAL SETTINGS LOGIC ---
    const settingsRef = ref(database, 'settings');
    document.getElementById('save-settings-btn').onclick = () => {
        set(settingsRef, {
            logoLink: document.getElementById('logo-link').value,
            telegramLink: document.getElementById('telegram-link').value,
            contactLink: document.getElementById('contact-link').value
        });
        alert('Settings Saved!');
    };
    onValue(settingsRef, (snapshot) => {
        const data = snapshot.val();
        if (data) {
            document.getElementById('logo-link').value = data.logoLink || '';
            document.getElementById('telegram-link').value = data.telegramLink || '';
            document.getElementById('contact-link').value = data.contactLink || '';
        }
    });

    // --- BATCHES & NESTED CONTENT LOGIC ---
    const batchesRef = ref(database, 'batches');
    const batchesListDiv = document.getElementById('batches-list');

    document.getElementById('add-batch-btn').onclick = () => {
        const title = document.getElementById('batch-title').value;
        const imageUrl = document.getElementById('batch-image').value;
        if (title && imageUrl) {
            push(batchesRef, { title, imageUrl, subjects: {} });
            document.getElementById('batch-title').value = '';
            document.getElementById('batch-image').value = '';
        } else {
            alert('Please provide both title and image URL for the batch.');
        }
    };

    onValue(batchesRef, (snapshot) => {
        batchesListDiv.innerHTML = '';
        const batchesData = snapshot.val();
        if (batchesData) {
            for (const batchId in batchesData) {
                const batch = batchesData[batchId];
                const batchContainer = document.createElement('div');
                batchContainer.className = 'section';
                
                // Render Batch Info and Delete Button
                let batchHTML = `
                    <div class="item">
                        <span>${batch.title}</span>
                        <button class="delete-btn" data-path="batches/${batchId}"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                
                // Render Subjects within this Batch
                batchHTML += '<div class="nested-section">';
                batchHTML += `<h4>Subjects in ${batch.title}</h4>`;
                const subjects = batch.subjects;
                if(subjects){
                    for(const subjectId in subjects){
                        const subject = subjects[subjectId];
                        batchHTML += `<div class="item"><span>${subject.title}</span><button class="delete-btn" data-path="batches/${batchId}/subjects/${subjectId}"><i class="fas fa-trash"></i></button></div>`;
                        
                        // Render Content within this Subject
                        batchHTML += '<div class="nested-section" style="background-color: var(--primary-bg);">';
                        batchHTML += `<h5>Content in ${subject.title}</h5>`;
                        const content = subject.content;
                        if(content){
                             for(const contentId in content){
                                 const item = content[contentId];
                                 batchHTML += `<div class="item" style="font-size: 0.9em;"><span>[${item.type}] ${item.title}</span><button class="delete-btn" data-path="batches/${batchId}/subjects/${subjectId}/content/${contentId}"><i class="fas fa-trash"></i></button></div>`;
                             }
                        }
                        // Add Content Form
                        batchHTML += `
                            <h4>Add Content to ${subject.title}</h4>
                            <select class="content-type" data-batch-id="${batchId}" data-subject-id="${subjectId}">
                                <option value="lecture">Lecture</option><option value="note">Note</option><option value="dpp">DPP</option>
                            </select>
                            <input type="text" class="content-title" placeholder="Content Title">
                            <input type="text" class="content-url" placeholder="Content Link/URL">
                            <button class="add-content-btn" data-batch-id="${batchId}" data-subject-id="${subjectId}">Add Content</button>
                        `;
                        batchHTML += `</div>`; // End content nested-section
                    }
                }
                
                // Add Subject Form
                batchHTML += `
                    <h4>Add Subject to ${batch.title}</h4>
                    <input type="text" class="subject-title" placeholder="New Subject Title">
                    <button class="add-subject-btn" data-batch-id="${batchId}">Add Subject</button>
                `;
                batchHTML += `</div>`; // End subjects nested-section

                batchContainer.innerHTML = batchHTML;
                batchesListDiv.appendChild(batchContainer);
            }
        }
    });

    // --- EVENT LISTENERS FOR DYNAMIC CONTENT ---
    batchesListDiv.addEventListener('click', e => {
        // Handle Delete Button Clicks
        if (e.target.closest('.delete-btn')) {
            const path = e.target.closest('.delete-btn').dataset.path;
            if (confirm('Are you sure you want to delete this? This action cannot be undone.')) {
                remove(ref(database, path));
            }
        }
        
        // Handle Add Subject Button Clicks
        if (e.target.matches('.add-subject-btn')) {
            const batchId = e.target.dataset.batchId;
            const title = e.target.previousElementSibling.value;
            if (title && batchId) {
                push(ref(database, `batches/${batchId}/subjects`), { title, content: {} });
            }
        }

        // Handle Add Content Button Clicks
        if (e.target.matches('.add-content-btn')) {
            const batchId = e.target.dataset.batchId;
            const subjectId = e.target.dataset.subjectId;
            const formDiv = e.target.parentElement;
            const type = formDiv.querySelector('.content-type').value;
            const title = formDiv.querySelector('.content-title').value;
            const url = formDiv.querySelector('.content-url').value;

            if (title && url && type) {
                push(ref(database, `batches/${batchId}/subjects/${subjectId}/content`), { type, title, url });
                formDiv.querySelector('.content-title').value = '';
                formDiv.querySelector('.content-url').value = '';
            } else {
                alert('Please fill all content fields.');
            }
        }
    });
</script>
</body>
</html>